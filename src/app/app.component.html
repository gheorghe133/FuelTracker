<section
  class="section is-flex is-justify-content-space-between is-align-items-center"
>
  <div
    class="container is-flex is-flex-direction-column is-justify-content-center is-align-items-center"
  >
    <div
      class="container is-flex is-justify-content-space-between is-align-items-center is-fullwidth mb-5"
    >
      <h1 class="is-size-3 has-text-weight-semibold">{{ title }}</h1>
      <button class="button" (click)="toggleTheme()">
        <span class="icon is-small">
          <ng-container *ngIf="currentTheme === 'light'; else dark">
            <i class="fa-solid fa-moon has-text-link is-size-5"></i>
          </ng-container>
          <ng-template #dark>
            <i class="fa-solid fa-sun has-text-link is-size-5"></i>
          </ng-template>
        </span>
      </button>
    </div>

    <form class="form" [formGroup]="searchForm" (ngSubmit)="search()">
      <div class="field is-fullwidth">
        <label class="label">Tip carburant</label>
        <div class="control">
          <div class="select is-fullwidth">
            <select formControlName="carburant">
              <option value="Benzina_Regular">Benzinǎ Standard</option>
              <option value="Motorina_Regular">Motorinǎ Standard</option>
              <option value="GPL">GPL</option>
              <option value="Benzina_Premium">Benzinǎ Superioarǎ</option>
              <option value="Motorina_Premium">Motorinǎ Superioarǎ</option>
              <option value="AdBlue">AdBlue</option>
            </select>
          </div>
        </div>
      </div>

      <div class="field">
        <label class="label">Nume locație</label>
        <div class="control">
          <label class="checkbox mr-2">
            <input type="radio" formControlName="locatie" value="Judet" />
            Raion
          </label>
          <label class="checkbox">
            <input type="radio" formControlName="locatie" value="Oras" />
            Localitate
          </label>
        </div>

        <div class="control has-icons-right mt-2">
          <input
            class="input"
            type="text"
            placeholder="Locație"
            formControlName="nume_locatie"
          />
          <span class="icon is-small is-right">
            <i class="fa-solid fa-location-dot has-text-link"></i>
          </span>
        </div>
      </div>

      <div class="field">
        <label class="label">Rețele benzinǎrii preferate</label>
        <div class="control">
          <div class="dropdown" [ngClass]="{ 'is-active': dropdownOpen }">
            <div class="dropdown-trigger">
              <button
                type="button"
                class="button is-fullwidth is-justify-content-space-between"
                aria-haspopup="true"
                aria-controls="dropdown-menu3"
                (click)="toggleDropdown()"
              >
                <span>
                  Benzinǎrii selectate ({{ selectedStations.length }})
                </span>
                <span class="icon is-small">
                  <i
                    class="fas fa-angle-down has-text-link"
                    aria-hidden="true"
                  ></i>
                </span>
              </button>
            </div>
            <div class="dropdown-menu" id="dropdown-menu3" role="menu">
              <div class="dropdown-content">
                <div class="dropdown-item">
                  <label class="checkbox">
                    <input
                      type="checkbox"
                      (change)="selectAll($event)"
                      [checked]="areAllSelected()"
                    />
                    Toate
                  </label>
                </div>
                <hr class="dropdown-divider" />
                @for(station of gasStations; track $index){
                <div class="dropdown-item">
                  <label class="checkbox">
                    <input
                      type="checkbox"
                      [value]="station"
                      (change)="selectStation(station, $event)"
                      [checked]="isSelected(station)"
                    />
                    {{ station }}
                  </label>
                </div>
                }
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="field">
        <div class="control">
          <div class="grid mt-5">
            <div class="cell">
              <button
                class="button is-link is-fullwidth"
                type="submit"
                [disabled]="searchForm.invalid || selectedStations.length === 0"
                [ngClass]="{ 'is-loading': loader }"
              >
                Submit
              </button>
            </div>
            <div class="cell">
              <button
                class="button is-link is-light is-fullwidth"
                type="button"
                (click)="cancel()"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </form>

    <div class="container has-text-right p-3" *ngIf="this.hasError">
      <p class="has-text-danger-60">{{ this.errorMessage }}</p>
    </div>
  </div>
  <div class="container">
    <div #mapContainer id="map"></div>
  </div>
</section>

<section class="section" *ngIf="fuelResults.length > 0">
  <div class="table-container">
    <table class="table is-fullwidth is-striped is-hoverable">
      <thead>
        <tr>
          <th (click)="sort('index')" class="is-clickable">
            Nr.
            <i class="fa-solid fa-sort"></i>
          </th>
          <th (click)="sort('date')" class="is-clickable">
            Date
            <i class="fa-solid fa-sort"></i>
          </th>
          <th (click)="sort('price')" class="is-clickable">
            Price
            <i class="fa-solid fa-sort"></i>
          </th>
          <th (click)="sort('gasStation')" class="is-clickable">
            Gas station
            <i class="fa-solid fa-sort"></i>
          </th>
          <th (click)="sort('city')" class="is-clickable">
            City
            <i class="fa-solid fa-sort"></i>
          </th>
          <th (click)="sort('address')" class="is-clickable">
            Address
            <i class="fa-solid fa-sort"></i>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let result of paginatedResults; let i = index"
          class="is-clickable"
          [ngClass]="{
            'has-background-link':
              this.selectedIndex ===
              (this.currentPage - 1) * this.itemsPerPage + i
          }"
          (click)="highlightStation(result)"
        >
          <th>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</th>
          <td>{{ result.date }}</td>
          <td>{{ result.price }}</td>
          <td>
            <div class="is-flex is-align-items-center">
              <img
                class="image is-32x32 mr-3"
                src="https://www.peco.md/{{ result.image }}"
                alt="{{ result.gasStation }}"
                title="{{ result.gasStation }}"
              />
              <span>{{ result.gasStation }}</span>
            </div>
          </td>
          <td>{{ result.city }}</td>
          <td>{{ result.address }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="pagination is-centered">
    <button
      class="button is-fullwidth pagination-previous"
      (click)="previousPage()"
      [disabled]="currentPage === 1"
    >
      Previous
    </button>

    <button class="button is-fullwidth pagination-previous">
      {{ currentPage }} / {{ totalPages }}
    </button>

    <button
      class="button is-fullwidth pagination-next"
      (click)="nextPage()"
      [disabled]="currentPage === totalPages"
    >
      Next
    </button>
  </div>
</section>
